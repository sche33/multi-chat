<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>Genel ve Özel Chat</title>
  <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
  <style>
    body { font-family: sans-serif; background: #121212; color: #fff; padding: 20px; }
    input, button, textarea, select { padding: 8px; border: none; border-radius: 4px; margin: 5px; }
    textarea { width: 100%; height: 100px; }
    #chat { border: 1px solid #444; padding: 10px; height: 300px; overflow-y: scroll; background: #1e1e1e; }
    #controls { margin-top: 10px; }
    .message { margin: 5px 0; }
    .you { color: lightgreen; }
    .other { color: skyblue; }
  </style>
</head>
<body>

<h2>Genel ve Özel Chat</h2>

<label>Kullanıcı Adı:</label>
<input type="text" id="username" placeholder="örnek: user123" />

<label>Mod:</label>
<select id="mode">
  <option value="genel">Genel Chat</option>
  <option value="özel">Özel Chat</option>
</select>

<div id="privateUserField" style="display: none;">
  <label>Özel Alıcı Kullanıcı Adı:</label>
  <input type="text" id="receiver" placeholder="örnek: user456" />
</div>

<button id="connectBtn">Bağlan</button>

<div id="chatArea" style="display:none;">
  <h3 id="roomTitle">Chat</h3>
  <div id="chat"></div>

  <div id="controls">
    <textarea id="messageInput" maxlength="500" placeholder="Mesajınızı yazın..."></textarea><br>
    <button id="sendBtn">Gönder</button>
  </div>
</div>

<script>
  let peer, conn;
  const chat = document.getElementById("chat");
  const usernameInput = document.getElementById("username");
  const receiverInput = document.getElementById("receiver");
  const modeSelect = document.getElementById("mode");
  const privateUserField = document.getElementById("privateUserField");
  const chatArea = document.getElementById("chatArea");
  const connectBtn = document.getElementById("connectBtn");
  const sendBtn = document.getElementById("sendBtn");

  modeSelect.addEventListener("change", () => {
    privateUserField.style.display = modeSelect.value === "özel" ? "block" : "none";
  });

  connectBtn.addEventListener("click", () => {
    const username = usernameInput.value.trim();
    if (!username) return alert("Lütfen kullanıcı adınızı girin.");
    peer = new Peer(username, { debug: 2 });

    peer.on("open", id => {
      chatArea.style.display = "block";
      const mode = modeSelect.value;
      document.getElementById("roomTitle").innerText = mode === "genel" ? "Genel Chat Odası" : `Özel Chat (${receiverInput.value})`;

      if (mode === "genel") {
        conn = peer.connect("public-room");
      } else {
        const receiver = receiverInput.value.trim();
        if (!receiver) return alert("Özel mesaj için bir kullanıcı adı girin.");
        conn = peer.connect(receiver);
      }

      conn.on("open", () => {
        conn.on("data", data => {
          addMessage(data, "other");
        });
      });
    });

    peer.on("connection", incoming => {
      incoming.on("data", data => {
        conn = incoming;
        addMessage(data, "other");
      });
    });
  });

  sendBtn.addEventListener("click", () => {
    const msg = document.getElementById("messageInput").value.trim();
    if (!msg || !conn || !conn.open) return;
    conn.send(msg);
    addMessage(msg, "you");
    document.getElementById("messageInput").value = "";
  });

  function addMessage(msg, who) {
    const div = document.createElement("div");
    div.className = `message ${who}`;
    div.textContent = `${who === "you" ? "Siz" : "Diğeri"}: ${msg}`;
    chat.appendChild(div);
    chat.scrollTop = chat.scrollHeight;
  }
</script>

</body>
</html>
